created: 20230207160613735
creator: æ—ä¸€äºŒ
modified: 20230207160626233
modifier: æ—ä¸€äºŒ
tags: å¤ªå¾®åŸç†
title: å¤ªå¾®å¦‚ä½•æ˜¾ç¤ºç•Œé¢
type: text/vnd.tiddlywiki

æœ‰ä¸€äº› JS ç¬”è®°ï¼Œå«æœ‰å…ƒä¿¡æ¯ `module-type: widget`ï¼Œå®ƒä»¬ exports ä¸Šçš„å†…å®¹ä¼šè¢«åŠ å…¥å¾®ä»¶ï¼ˆWidgetï¼‰æ³¨å†Œè¡¨ï¼Œå¾…ç”¨ã€‚

ç”¨æˆ·æ—¥å¸¸å†™çš„ç¬”è®°ï¼Œè¿›å…¥æ¸²æŸ“æµç¨‹åï¼Œä¼šè¢«è§£æå™¨å˜æˆæŠ½è±¡è¯­æ³• ğŸŒ²ï¼Œä¾‹å¦‚ä¸€ç¯‡çº¯çº¯çš„æ–‡æœ¬ç¬”è®°ï¼Œé€šè¿‡ `$tw.wiki.parseText('text/vnd.tiddlywiki', input).tree` ä¼šè§£æå‡ºï¼š

```js
{type: "text", text: <string>} // a text node
```

æ­¤åå°†è¿™é¢—è¯­æ³•æ ‘é€šè¿‡æ ¸å¿ƒ API è½¬æ¢æˆ DOM èŠ‚ç‚¹ï¼š

```js
const newWidgetNode = parentWidget.makeChildWidget(parseTreeNode);
newWidgetNode.render(domNode, null);
```

è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šå»æŸ¥è¡¨ï¼Œæ‰¾åˆ°ç›¸åº”çš„å¾®ä»¶æ¸²æŸ“å™¨ï¼š

```js
/*\
title: $:/core/modules/widgets/text.js
type: application/javascript
module-type: widget

Text node widget

\*/
/*
Inherit from the base widget class
*/
TextNodeWidget.prototype = new Widget();
/*
Render this widget into the DOM
*/
TextNodeWidget.prototype.render = function(parent,nextSibling) {
  this.parentDomNode = parent;
  this.computeAttributes();
  this.execute();
  var text = this.getAttribute("text",this.parseTreeNode.text || "");
  text = text.replace(/\r/mg,"");
  var textNode = this.document.createTextNode(text);
  parent.insertBefore(textNode,nextSibling);
  this.domNodes.push(textNode);
};
```

æ‰§è¡Œ `render` æ–¹æ³•åï¼Œå°±å®Œæˆäº†æ¸²æŸ“ã€‚åœ¨ç”¨æˆ·æ”¹åŠ¨æ–‡æœ¬åï¼Œä¼šæœ‰å…¶ä»–ç”Ÿå‘½å‘¨æœŸæ–¹æ³•è¢«è°ƒç”¨ï¼Œä»è€Œåˆ·æ–°ç•Œé¢ã€‚

ç”±äºå¾®ä»¶æ¸²æŸ“å™¨ä¹Ÿæ˜¯ä¸ªç¬”è®°ï¼Œæ‰€ä»¥è¯´å¯ä»¥é€šè¿‡æ’ä»¶ç¤¾åŒºæ¥åˆ†å‘ï¼Œè®©ç”¨æˆ·æŒ‰éœ€åŠ è½½ã€‚